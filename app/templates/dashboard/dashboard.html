{% extends 'base/dashboard-base.html' %}

{% block title %} Home {% endblock %}

{% block navbar %}
            <div class="user-section">
                <img class="user-avatar" src="{{ url_avatar }}" alt="User Avatar">
                <span class="user-name">{{ display_name }}</span>
                <a href="{{ url_for('auth.logout') }}">{{ gettext('Uitloggen') }}</a>
            </div>
{% endblock %}

{% block content %}
        <h1>Dashboard</h1>
        <p>{{ gettext('Ingelogd als') }}: {{ display_name }}</p>

        <h2>{{ gettext('Mijn statestieken') }}</h2>
        <p>{{ gettext('Uren gespeeld deze 2 weken') }}: {{ playtime }}</p>

    {% if afstand %}
        <h2>{{ gettext('Afstand tussen laptop: ') }}</h2>
        <p id="afstand"></p>
    {% else %}
        <p>{{ gettext('Fout: We konden de afstand niet ophalen.') }}</p>
        <a href="{{ url_for('dashboard.index') }}">{{ gettext('Ga terug') }}</a>
    {% endif %}

        <h2>{{ gettext('Meest gespeelde spelen deze 2 weken:') }}</h2>
    {% if games %}
        <table>
            <thead>
                <tr>
                    <th><h2>{{ gettext('Naam van spel') }}</h2></th>
                    <th><h2>{{ gettext('Uren deze 2 weken') }}</h2></th>
                </tr>
            </thead>
            <tbody>
                {% for game in games %}
                    <tr>
                        <td>{{ game.name }}</td>
                        <td>{{ game.playtime_2weeks }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>{{ gettext('Fout: We konden je bibliotheek niet ophalen.') }}</p>
        <p>{{ gettext('Mogelijk staat je bibliotheek op prive.') }}</p>
    {% endif %}

    <script>
        function updateAfstand() {
            // Maak een variabele met de URL van de room_detail view
            const afstand_url = "{{ url_for('dashboard.afstand', afstand=afstand) }}";
            
            // Fetch data van de afstand API
            fetch(afstand_url)
                .then(response => response.json())
                .then(data => {
                    // Assuming the response has 'afstand' as a key
                    const afstandValue = data;
                    
                    // Update the UI with the fetched afstand value
                    const afstandElement = document.getElementById('afstand');
                    afstandElement.innerHTML = `${afstandValue}`;
                })
                .catch(error => {
                    console.error('Error fetching afstand:', error);
                });
        }
        
        setInterval(updateAfstand, 1000);
    </script>

{% endblock %}